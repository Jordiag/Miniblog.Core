<?xml version="1.0" encoding="utf-8"?>
<post>
  <title>RPi 4 K8s multi-master cluster using Ubuntu and Kubespray</title>
  <slug>rasberry-4-pi-kubernetes-cluster-multi-master-ubuntu-kubespray</slug>
  <pubDate>2020-01-04T20:29:08.752Z</pubDate>
  <lastModified>2020-01-07T21:13:33.914Z</lastModified>
  <excerpt>Create a high availability raspberry pi 4 kubernetes cluster based on ubuntu and deployed using kubespray.</excerpt>
  <content>&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;strong&gt;INTRODUCTION&lt;/strong&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;Recently, I've been thinking about improving my Kubernetes (K8s) Raspberry Pi cluster to a something more resilient than just a one K8s master cluster which can fail easely and ruin all your work of months on it.&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;I installed multiple times on-premise single master K8s clusters based on Redhat ecosystem ( Centos/Fedora). The difficulty of doing this manually if it's your first time it's far from easy, and if you want to install something closer to an on premises HA K8s cluster manually it becomes quite uncomfortable.&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;So the the challenge was to find a simple way to install a multi-master K8s cluster using my new 10 raspberry Pi 4 (4Gb Ram) project.&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;This article intends to share my experience doing this task as a quick and easy guide to anybody that wants the same results without loosing hours on it.&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;strong&gt;THE SOFTWARE BASE&lt;/strong&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;The keys to reach this goal was to use:&lt;/span&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;- Kubespray K8s deployment tool.&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;- Ubuntu 18.04 for Arm64.&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;Kubespray&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;a style="background-color: transparent;" href="https://kubespray.io/#/"&gt;https://kubespray.io/#/&amp;nbsp;&lt;/a&gt;&lt;span style="background-color: transparent;"&gt;is a very good tool to ease your pain deploying highly available K8s clusters. It uses ansible playbooks and works with some major linux distributions and hardward platforms.&amp;nbsp;&lt;/span&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;In the pre-installation you can configure&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="background-color: transparent;"&gt;your cluster&amp;nbsp;&lt;/span&gt;&lt;span style="background-color: transparent;"&gt;desired structure for instance: using several masters and etcd replicated databases.&lt;/span&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;I tried some combinations of linux distributions and mostly all failed due it's difficult to find a linux distro that suits Kubespray and the new Raspberry Pi 4 (4Gb RAM) hardware.&lt;br /&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;At this moment Raspbian it's compiled for Arm32&lt;span style="background-color: transparent;"&gt;/armhf and Kubespray will fail installing packages like calico&amp;nbsp;&lt;/span&gt;&lt;span style="background-color: transparent;"&gt;&amp;nbsp;and&amp;nbsp;&lt;/span&gt;&lt;span style="background-color: transparent;"&gt;and etcd has experimental support for arm32 https://etcd.io/docs/v3.3.12/op-guide/supported-platform/, so better to use arm64. On the other side, Raspbian Arm64 is experimental and not officially supported by Kubespray so better not use any of these distros yet avoiding unexpected issues.&lt;br /&gt;&lt;/span&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&lt;span style="background-color: transparent;"&gt;The current latest Ubuntu 19.10 (Eoan Ermine) has a Preinstalled server image&amp;nbsp;for the new Raspberry Pi 4 compiled for arm64&amp;nbsp;&lt;/span&gt;&lt;/span&gt;&lt;a style="background-color: transparent;" href="http://cdimage.ubuntu.com/ubuntu/releases/19.10/release/"&gt;http://cdimage.ubuntu.com/ubuntu/releases/19.10/release/&lt;/a&gt;&amp;nbsp;but it's not supported officially by Kubespray and if you try to install it things like Docker installation process will fail because there is no repo for Ubuntu 19.10 yet:&amp;nbsp;&lt;a style="background-color: transparent;" href="https://download.docker.com/linux/ubuntu/dists/"&gt;https://download.docker.com/linux/ubuntu/dists/&amp;nbsp;&lt;/a&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;so maybe this distro will be a good candidate in near months.&lt;br /&gt;Thinking that what I wanted was a long term support stable distro to avoid collateral issues I thought about Ubuntu 18.04 LTS which will be supported for 5 years until April 2023. But, the current official Ubuntu 18.04 LTS doesn't have a preinstalled server image&amp;nbsp;for the new Raspberry Pi 4 http://cdimage.ubuntu.com/ubuntu/releases/18.04.3/release/&amp;nbsp; , maybe later they'll release it but now just Raspberry Pi 2/3 are supported.&lt;br /&gt;&lt;/span&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;While Ubuntu releases 18.04 LTS for Raspberry Pi 4 (Arm64) I found an unofficial preinstalled server image&amp;nbsp;for the new Raspberry Pi 4 that works like a charm.&amp;nbsp;&lt;a style="background-color: transparent;" href="https://github.com/TheRemote/Ubuntu-Server-raspi4-unofficial"&gt;https://github.com/TheRemote/Ubuntu-Server-raspi4-unofficial&lt;/a&gt;&lt;/span&gt;&lt;span style="font-family: Segoe UI VSS (Regular), Segoe UI, -apple-system, BlinkMacSystemFont, Roboto, Helvetica Neue, Helvetica, Ubuntu, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;"&gt;&amp;nbsp;&lt;/span&gt;&lt;a style="background-color: transparent;" href="https://jamesachambers.com/raspberry-pi-4-ubuntu-server-desktop-18-04-3-image-unofficial/"&gt;https://jamesachambers.com/raspberry-pi-4-ubuntu-server-desktop-18-04-3-image-unofficial/&lt;/a&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;Using this unofficial distro you'll still be able to update Ubuntu linux packages from the Official repo, the only thing you'll have to care is about kernel packages, but this will be described below.&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;strong&gt;SETTING UP THE INSTALLATION CONTROLLER NODE&lt;/strong&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;The first thing needed is a controller machine from where you're are going to install K8s to your Raspberry Pi cluster. I used my Windows 10 machine installing the Ubuntu 18.04 subsystem.&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;strong&gt;SETTING UP THE RASPBERRY PI 4 INSTALLATION BASE&lt;/strong&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;The second step is to have installed&amp;nbsp;&lt;span style="background-color: transparent;"&gt;Ubuntu 18.04 LTS for (Arm64) in all your&amp;nbsp;&lt;/span&gt;&lt;span style="background-color: transparent;"&gt;Raspberry Pi 4, in my case I installed it in 10&amp;nbsp;&lt;/span&gt;&lt;span style="background-color: transparent;"&gt;Raspberry Pi 4.&lt;/span&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;1. Flash ubuntu 18.04 https://github.com/TheRemote/Ubuntu-Server-raspi4-unofficial/releases/tag/v12 using balenaEtcher or nay other app&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;2. Change ubuntu/ubuntu user admin password: he_____6&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;3. Change keyboard layout to gb: sudo vi /etc/default/keyboard -&amp;gt; XKBLAYOUT="gb"&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;4. Update all packages: sudo apt-get update &amp;amp;&amp;amp; sudo apt-get --with-new-pkgs upgrade &amp;amp;&amp;amp; sudo reboot&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;5. Change hostname and reboot https://www.cyberciti.biz/faq/ubuntu-18-04-lts-change-hostname-permanently/&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;6. Change to static ip: (ubuntu server: netplan option) https://linuxconfig.org/how-to-configure-static-ip-address-on-ubuntu-18-04-bionic-beaver-linux&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;7. Create a folder/mnt/k8s&amp;nbsp; and add this line to fstab: //192.168.1.60/k8s /mnt/k8s cifs noauto,x-systemd.automount,vers=1.0,user,uid=500,rw,suid,username=sharedk8s,password=64s6Hgi8 0 0&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;8. safe base distro image with win32diskimager (read)&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;9. clone base distro image with win32diskimager (write) to a new sd card&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;10. change hostname&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;11. get new mac addrees&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;12. change ip and macaddress, get with ifconfig -a , set in /etc/netplan/*****&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;13. reboot and check all chenges are ok&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;sudo nano /etc/netplan/50-cloud-init.yaml &amp;amp;&amp;amp; sudo hostnamectl set-hostname pi10cluster.chanlabs.com &amp;amp;&amp;amp; sudo nano /etc/hosts &amp;amp;&amp;amp; sudo halt -p&lt;/div&gt;
&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;strong&gt;Kubespray instructions from win ubuntu install controller&lt;/strong&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;ssh-keygen -t rsa&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;Saved key /home/pi/.ssh/id_rsa&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;ssh-copy-id 192.168.1.30&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;Are you sure you want to continue connecting (yes/no)? yes&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;(answer your password)&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;repeat lines 7-9 for all the cluster ips&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;Edit /etc/sudoers in all nodes and add line after the sudo one to avoid password questions (line 15)&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;# Allow members of group sudo to execute any command&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;%sudo&amp;nbsp; &amp;nbsp;ALL=(ALL:ALL) ALL&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;pi ALL=(ALL:ALL) NOPASSWD:ALL&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;sudo apt install python3-pip&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;sudo pip3 install --upgrade pip&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;pip --version&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;sudo apt install git&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;git clone https://github.com/kubernetes-sigs/kubespray.git&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;cd kubespray/&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;git describe --tags para saber la version actual y actualizar luego: https://kubespray.io/#/docs/upgrades&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;sudo pip install -r requirements.txt&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;cp -rfp inventory/sample inventory/mycluster&amp;nbsp;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;declare -a IPS=(192.168.1.30 192.168.1.31 192.168.1.32 92.168.1.33 192.168.1.34 92.168.1.35 192.168.1.36 192.168.1.37 192.168.1.38 92.168.1.39 192.168.1.4 192.168.1.5 192.168.1.6 192.168.1.7 192.168.1.9)&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;CONFIG_FILE=inventory/mycluster/hosts.yml python3 contrib/inventory_builder/inventory.py ${IPS[@]}&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;review files and change hostnames ojo balance numero masters y etcds, check:&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;nano inventory/mycluster/hosts.yml&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;nano inventory/mycluster/group_vars/all/all.yml&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;nano inventory/mycluster/group_vars/k8s-cluster/k8s-cluster.yml&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;ansible-playbook -i inventory/mycluster/hosts.yml --become --become-user=root cluster.yml&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;anadir aqui lista de instalar kubectl del video del tio y poner como ver dashboard que viene pre instalado&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;ignore to upgrade these packages in Ubuntu managed by Kubespray:&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;span style="background-color: transparent;"&gt;apt-transport-https aufs-tools cgroupfs-mount containerd.io docker-ce docker-ce-cli ipset ipvsadm libipset3 libltdl7 libpython-stdlib libpython2-stdlib libpython2.7-minimal&amp;nbsp;&lt;/span&gt;libpython2.7-stdlib pigz python python-apt python-minimal python2 python2-minimal python2.7 python2.7-minimal socat&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;strong&gt;NUMBER OF MASTERS / ETCD ERROR&amp;nbsp;&lt;/strong&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;[pi3cluster -&amp;gt; 192.168.1.30]: FAILED! =&amp;gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;{"changed": true,&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;"cmd": ["bash", "-x",&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;"/usr/local/bin/etcd-scripts/make-ssl-etcd.sh",&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;"-f", "/etc/ssl/etcd/openssl.conf", "-d", "/etc/ssl/etcd/ssl"], "delta": "0:00:00.007623",&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;"end": "2019-12-21 13:10:13.140942", "msg": "non-zero return code", "rc": 127, "start": "2019-12-21 13:10:13.133319",&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;"stderr": "bash: /usr/local/bin/etcd-scripts/make-ssl-etcd.sh: No such file or directory",&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;"stderr_lines": ["bash: /usr/local/bin/etcd-scripts/make-ssl-etcd.sh: No such file or directory"],&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;"stdout": "",&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;"stdout_lines": []}&lt;/div&gt;
&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&lt;strong&gt;Skip kernel on updates&lt;/strong&gt;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;https://github.com/TheRemote/Ubuntu-Server-raspi4-unofficial&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;sudo apt-mark hold flash-kernel linux-raspi2 linux-image-raspi2 linux-headers-raspi2 linux-firmware-raspi2 linux-firmware&lt;/div&gt;
&lt;/div&gt;
&lt;div style="box-sizing: border-box; background: transparent; margin-bottom: 0px; margin-top: 14px;"&gt;&amp;nbsp;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;</content>
  <ispublished>true</ispublished>
  <categories>
    <category>raspberry-pi</category>
    <category>kubernetes</category>
    <category>kubespray</category>
  </categories>
  <comments></comments>
</post>